#/usr/bin/env sh

should_succeed() {
    echo Running: "$@"
    eval "$@"
    if [ $? -ne 0 ]
    then
        echo ERROR: Command should have succeeded
        exit 1
    else
        echo Test Passed
    fi
}
should_fail() {
    echo Running: "$@"
    eval "$@"
    if [ $? -eq 0 ]
    then
        echo ERROR: Command should have failed
        exit 1
    else
        echo Test Passed
    fi
}

# No module
should_succeed cargo run -- run --target erlang
should_succeed cargo run -- run --target javascript --runtime nodejs
should_succeed cargo run -- run --target javascript --runtime deno

# Module from same package
should_succeed cargo run -- run --module module --target erlang
should_succeed cargo run -- run --module module --target javascript --runtime nodejs
should_succeed cargo run -- run --module module --target javascript --runtime deno

# Nested module from same package
should_succeed cargo run -- run --module module/sub_module --target erlang
should_succeed cargo run -- run --module module/sub_module --target javascript --runtime nodejs
should_succeed cargo run -- run --module module/sub_module --target javascript --runtime deno

# Unknown module
should_fail cargo run -- run --module doesnt_exist

# No main function
should_fail cargo run -- run --module module/no_main_function

# Main function with wrong arity
should_fail cargo run -- run --module module/wrong_arity
